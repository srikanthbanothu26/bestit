<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessments</title>
    <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100">
    <div class="container mx-auto py-8 flex">
        <div class="w-3/4 bg-white rounded-lg shadow-md p-6">
            <h2 id="question-title" class="text-xl font-semibold mb-4"></h2>
            <ul id="options-list" class="list-disc ml-8"></ul>
            <div class="flex justify-between mt-4">
                <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded" onclick="prevQuestion()">Previous</button>
                <button id="next-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="nextQuestion()">Next</button>
            </div>
        </div>
        <div class="w-1/4 ml-8">
            <h2 class="text-xl font-bold mb-4">Questions</h2>
            <div id="question-list" class="grid grid-cols-4 gap-y-4">
                {% for index, _ in enumerate(assessments) %}
                    <div class="items-center question-number cursor-pointer border-2 rounded-full justify-center flex mr-4 h-10 w-10 border-green-800" onclick="showQuestion({{ index }})">{{ index + 1 }}</div>
                {% endfor %}
            </div>
        </div>
        <div class="bg-black text-white h-96 w-60 grid grid-cols-1 justify-center items-center rounded-md">
            <div class="pl-8 pr-8">
                <div class="profile-image-container justify-center">
                    {% if current_user.profile_image %}
                    <img id="profile-image" src="{{ url_for('static', filename='profile_pics/' + current_user.profile_image) }}" class="h-24 w-24 rounded-full" alt="{{ current_user.username }}'s Profile Image" onerror="this.onerror=null;this.src='{{ url_for('static', filename='profile_pics/profile.png') }}';" />
                    {% else %}
                    <img id="profile-image" src="{{ url_for('static', filename='profile_pics/default.png') }}" class="h-16 w-16 rounded-full" alt="Default Profile Image">
                    {% endif %}
                </div>
                <button id="edit-profile-btn" class="ml-20 border-2 flex inline text-white rounded h-8 w-16">Update</button>
                <input type="file" id="file-upload" accept="image/*" style="display: none;">
                <button id="upload-btn" style="display: none;" class="bg-green-600">Upload</button>
                <p class="mt-8">name:{{current_user.username}}<p>
                <p>id:{{current_user.id}}</p>
                <p class="flex justify-center">email:{{current_user.email}}</p>
                <p class="mb-10">course:{{current_user.course}}</p>
                <a href="/" class="border border-white py-1 px-3 rounded-lg mt-8">LOGOUT</a>
            </div>
        </div>
    </div>
    <script>
        const questions = [
            {% for assessment in assessments %}
                {
                    question: "{{ assessment.question }}",
                    options: [
                        "{{ assessment.option1 }}",
                        "{{ assessment.option2 }}",
                        "{{ assessment.option3 }}",
                        "{{ assessment.option4 }}"
                    ]
                },
            {% endfor %}
        ];

        const questionTitle = document.getElementById('question-title');
        const optionsList = document.getElementById('options-list');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // Initially display the first question
        let currentQuestionIndex = 0;
        showQuestion(currentQuestionIndex);

        function showQuestion(index) {
            const question = questions[index];
            questionTitle.textContent = `Question ${index + 1}: ${question.question}`;
            optionsList.innerHTML = '';
            question.options.forEach(option => {
                const li = document.createElement('li');
                li.textContent = option;
                optionsList.appendChild(li);
            });
            // Highlight selected question
            const questionNumbers = document.querySelectorAll('.question-number');
            questionNumbers.forEach((elem, idx) => {
                if (idx === index) {
                    elem.classList.add('font-bold', 'text-blue-500');
                } else {
                    elem.classList.remove('font-bold', 'text-blue-500');
                }
            });
            // Disable prev/next buttons if at the first or last question
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === questions.length - 1;
            currentQuestionIndex = index;
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        }
    </script>
    <script>
        document.getElementById('upload-btn').addEventListener('click', function() {
            var fileInput = document.getElementById('file-upload');
            var file = fileInput.files[0];
            if (file) {
                var formData = new FormData();
                formData.append('profile_image', file);
                
                fetch('/upload_profile_image', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    if (data.success) {
                        document.getElementById('profile-image').src = data.profile_image_url;
                        alert('Profile image uploaded successfully.');
                    } else {
                        alert('Failed to upload profile image.');
                    }
                })
                .catch(error => {
                    console.error('There was an error with the fetch operation:', error);
                });
            } else {
                alert('No file selected.');
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editBtn = document.getElementById('edit-profile-btn');
            const fileUpload = document.getElementById('file-upload');
            const uploadBtn = document.getElementById('upload-btn');
    
            editBtn.addEventListener('click', function() {
                fileUpload.style.display = 'block';
                uploadBtn.style.display = 'block';
            });
        });
    </script>   
</body>
</html>
